<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Û³: Ø¨Ø®Ø´ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ</title>
    <style>
        :root {
            --box-color: #D7CCC8; /* Ø±Ù†Ú¯ Ú©Ø§Ø±ØªÙ† */
            --box-border: #8D6E63;
            --choco-color: #5D4037; /* Ø±Ù†Ú¯ Ø´Ú©Ù„Ø§Øª */
            --void-color: rgba(255, 82, 82, 0.2); /* Ø±Ù†Ú¯ ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ */
            --accent: #FF6F00;
            --bg-warehouse: #CFD8DC;
            --success: #43A047;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-warehouse);
            color: #37474F;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #263238;
            border-bottom: 4px solid var(--accent);
            padding-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            text-align: center;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1100px;
            width: 100%;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-top: 10px solid var(--box-border);
            box-sizing: border-box; /* Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ø¹Ø±Ø¶ */
        }

        /* Ù¾Ù†Ù„ Ø³Ù…Øª Ø±Ø§Ø³Øª (Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§) */
        .controls-panel {
            flex: 1;
            min-width: 280px; /* Ú©Ù…ÛŒ Ú©Ø§Ù‡Ø´ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
            padding: 20px;
            background: #FFF3E0;
            border-radius: 8px;
            border: 1px dashed var(--accent);
        }

        /* Ù¾Ù†Ù„ Ø³Ù…Øª Ú†Ù¾ (Ù†Ù…Ø§ÛŒØ´) */
        .visual-panel {
            flex: 2;
            min-width: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        canvas {
            background: radial-gradient(circle, #ffffff 0%, #f0f0f0 100%);
            border-radius: 8px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            border: 1px solid #ccc;
            /* ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø´Ø¯Ù† */
            width: 100%; /* Ø¹Ø±Ø¶ Ø±Ø§ Ø¨Ø§ ÙˆØ§Ù„Ø¯ Ù¾Ø± Ú©Ù†Ø¯ */
            height: auto; /* Ø§Ø±ØªÙØ§Ø¹ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© */
            max-width: 500px; /* Ø§Ù…Ø§ Ø§Ø² 500 Ø¨Ø²Ø±Ú¯ØªØ± Ù†Ø´ÙˆØ¯ */
        }

        /* Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ */
        .input-group { margin-bottom: 25px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #4E342E; }
        
        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px; height: 22px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: 2px solid white;
        }

        .value-badge {
            float: left;
            background: var(--box-border);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* Ø¬Ø¹Ø¨Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ¶Ø¹ÛŒØª */
        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-top: 20px;
            text-align: center;
            width: 90%; /* Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ú©Ù…ÛŒ Ø¹Ø±ÛŒØ¶â€ŒØªØ± Ø´ÙˆØ¯ */
            max-width: 400px;
        }

        .big-number {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--choco-color);
            margin: 10px 0;
            line-height: 1;
        }

        .efficiency-bar {
            height: 10px;
            width: 100%;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        .efficiency-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.5s, background 0.3s;
        }

        /* Ù‡Ø¯Ù Ù…Ø§Ù…ÙˆØ±ÛŒØª */
        .mission-box {
            background: #263238;
            color: var(--accent);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .mission-box::before {
            content: "âš ï¸";
            position: absolute;
            top: -10px; right: -10px;
            font-size: 5em;
            opacity: 0.1;
        }

        .status-msg { margin-top: 15px; font-weight: bold; font-size: 1.1em; color: #333; min-height: 30px;}
        .win-anim { animation: bounce 0.6s; color: var(--success); }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
            padding: 20px; /* ÙØ§ØµÙ„Ù‡ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            box-sizing: border-box;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 10px;
            max-width: 550px; width: 100%; text-align: center;
            border-bottom: 6px solid var(--accent);
        }
        .start-btn {
            background: var(--accent); color: white; border: none;
            padding: 12px 30px; font-size: 1.2em; border-radius: 50px;
            cursor: pointer; margin-top: 20px; transition: 0.2s;
        }
        .start-btn:hover { transform: scale(1.05); background: #E65100; }
        .hidden { display: none; }

        /* ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø®ØµÙˆØµ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø§Ø³Ø¨ Ø¨Ù‡ØªØ± */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* Ú©Ø§Ù‡Ø´ Ù¾Ø¯ÛŒÙ†Ú¯ Ø¨Ø¯Ù†Ù‡ */
            }
            .container {
                padding: 15px; /* Ú©Ø§Ù‡Ø´ Ù¾Ø¯ÛŒÙ†Ú¯ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ */
                flex-direction: column-reverse; /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ù¾Ø§ÛŒÛŒÙ†ØŒ ØªØµÙˆÛŒØ± Ø¨Ø§Ù„Ø§ */
            }
            .visual-panel {
                margin-bottom: 20px;
            }
            h1 {
                font-size: 1.5em;
            }
        }

    </style>
</head>
<body>

    <div id="introModal" class="modal">
        <div class="modal-content">
            <h2>ğŸšš Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Û³: Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ (Container)</h2>
            <p style="font-size: 1.1em; line-height: 1.6;">
                ØªØ¨Ø±ÛŒÚ©! Ø´Ú©Ù„Ø§Øªâ€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ùˆ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.
                <br>
                Ø­Ø§Ù„Ø§ Ø¨Ø§ÛŒØ¯ ØªØ¹Ø¯Ø§Ø¯ Ø²ÛŒØ§Ø¯ÛŒ Ø§Ø² Ø¢Ù†â€ŒÙ‡Ø§ (Ù…Ø«Ù„Ø§Ù‹ Û¶Û´ ÛŒØ§ Û±Û°Û° ØªØ§) Ø±Ø§ Ø¯Ø§Ø®Ù„ ÛŒÚ© <strong>Ú©Ø§Ø±ØªÙ† Ø¨Ø²Ø±Ú¯ Ù…Ø§Ø¯Ø±</strong> Ø¨Ú†ÛŒÙ†ÛŒÙ… Ùˆ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø¨ÙØ±Ø³ØªÛŒÙ….
            </p>
            <p style="background:#FFF3E0; padding:10px; border-radius:5px;">
                <strong>Ú†Ø§Ù„Ø´:</strong> Ø§Ø¨Ø¹Ø§Ø¯ Ú©Ø§Ø±ØªÙ† Ø¨Ø²Ø±Ú¯ Ø±Ø§ Ø·ÙˆØ±ÛŒ ØªÙ†Ø¸ÛŒÙ… Ú©Ù† Ú©Ù‡ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ§Ø±Ø´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± Ø¢Ù† Ø¬Ø§ Ø´ÙˆØ¯ Ùˆ Ù‡ÛŒÚ† <strong>ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ (Ù‡ÙˆØ§)</strong> Ø¨Ø§Ù‚ÛŒ Ù†Ù…Ø§Ù†Ø¯.
            </p>
            <button class="start-btn" onclick="startGame()">Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª</button>
        </div>
    </div>

    <h1>ğŸ“¦ Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Û³: Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ</h1>

    <div class="container" id="mainContainer">
        
        <div class="controls-panel">
            <div class="mission-box">
                <h3 style="margin:0; color: white; font-size:0.9em;">Ø³ÙØ§Ø±Ø´ Ø§Ù†Ø¨Ø§Ø±:</h3>
                <div style="font-size: 2.2em; font-weight:bold; margin: 10px 0;">
                    <span id="targetCount">0</span> Ø¨Ø³ØªÙ‡
                </div>
                <div style="font-size: 0.8em; color:#ddd;">(Ø§Ø¨Ø¹Ø§Ø¯ Ù‡Ø± Ø¨Ø³ØªÙ‡ Ø´Ú©Ù„Ø§Øª: Û² Ã— Û² Ã— Û²)</div>
                <button onclick="generateMission()" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.5); color:white; padding:5px 10px; cursor:pointer; margin-top:5px; border-radius:4px;">Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ ğŸ”„</button>
            </div>

            <div class="input-group">
                <label>Ø·ÙˆÙ„ Ú©Ø§Ø±ØªÙ† (L): <span class="value-badge" id="val-L">10</span></label>
                <input type="range" id="rangeL" min="2" max="16" step="1" value="10" oninput="updateDims()">
            </div>
            
            <div class="input-group">
                <label>Ø¹Ø±Ø¶ Ú©Ø§Ø±ØªÙ† (W): <span class="value-badge" id="val-W">10</span></label>
                <input type="range" id="rangeW" min="2" max="16" step="1" value="10" oninput="updateDims()">
            </div>

            <div class="input-group">
                <label>Ø§Ø±ØªÙØ§Ø¹ Ú©Ø§Ø±ØªÙ† (H): <span class="value-badge" id="val-H">10</span></label>
                <input type="range" id="rangeH" min="2" max="16" step="1" value="10" oninput="updateDims()">
            </div>

            <div id="statusMsg" class="status-msg"></div>
        </div>

        <div class="visual-panel">
            <canvas id="packCanvas"></canvas>
            
            <div class="info-card">
                <div style="display:flex; justify-content:space-around;">
                    <div>
                        <div style="font-size:0.9em; color:#777;">ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø§ Ø´Ø¯Ù‡</div>
                        <div class="big-number" id="fitCount">0</div>
                    </div>
                    <div>
                        <div style="font-size:0.9em; color:#777;">ÙØ¶Ø§ÛŒ Ù¾Ø±Øª (Ù‡ÙˆØ§)</div>
                        <div class="big-number" id="wastedSpace" style="color: #D32F2F;">0%</div>
                    </div>
                </div>
                <div class="efficiency-bar">
                    <div class="efficiency-fill" id="effBar"></div>
                </div>
                <div style="font-size:0.8em; margin-top:5px; color:#555;">Ø¨Ø§Ø²Ø¯Ù‡ÛŒ ÙØ¶Ø§</div>
            </div>
        </div>

    </div>
    <script>
        // Ø§Ø¨Ø¹Ø§Ø¯ Ø«Ø§Ø¨Øª Ù‡Ø± Ø¨Ø³ØªÙ‡ Ø´Ú©Ù„Ø§Øª Ú©ÙˆÚ†Ú©
        const ITEM_SIZE = 2; 
        
        const canvas = document.getElementById('packCanvas');
        const ctx = canvas.getContext('2d');
        
        const state = {
            box: { L: 10, W: 10, H: 6 }, // Ø§Ø¨Ø¹Ø§Ø¯ Ú©Ø§Ø±ØªÙ† Ø¨Ø²Ø±Ú¯
            target: 0,
            fitted: 0,
            efficiency: 0
        };

        // --- ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨ÙˆÙ… ---
        function resizeCanvas() {
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø§Ù† ÙˆØ§Ù„Ø¯ Ø±Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
            const parentWidth = canvas.parentElement.clientWidth;
            // Ø¹Ø±Ø¶ Ø¨ÙˆÙ… Ø±Ø§ Ø¨Ø±Ø§Ø¨Ø± ÙˆØ§Ù„Ø¯ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… (Ø¨Ø§ Ø±Ø¹Ø§ÛŒØª Ø­Ø¯Ø§Ú©Ø«Ø± 500)
            const newWidth = Math.min(parentWidth, 500);
            // Ø§Ø±ØªÙØ§Ø¹ Ø±Ø§ Ù…ØªÙ†Ø§Ø³Ø¨ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (Ù†Ø³Ø¨Øª 5:4)
            const newHeight = newWidth * 0.8; 
            
            // ØªÙ†Ø¸ÛŒÙ… Ø±Ø²ÙˆÙ„ÙˆØ´Ù† Ø¯Ø§Ø®Ù„ÛŒ Ø¨ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ§Ø±ÛŒ
            canvas.width = newWidth;
            canvas.height = newHeight;
            
            // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±Ø³Ù… Ú©Ù†
            if (state.target > 0) draw();
        }

        // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ± Ø³Ø§ÛŒØ² ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯ Ø¨ÙˆÙ…
        window.addEventListener('resize', resizeCanvas);


        function startGame() {
            document.getElementById('introModal').classList.add('hidden');
            resizeCanvas(); // ØªÙ†Ø¸ÛŒÙ… Ø§ÙˆÙ„ÛŒÙ‡ Ø³Ø§ÛŒØ²
            generateMission();
        }

        // ØªÙˆÙ„ÛŒØ¯ Ù…Ø§Ù…ÙˆØ±ÛŒØª Ù…Ù†Ø·Ù‚ÛŒ (Ø¹Ø¯Ø¯ÛŒ Ú©Ù‡ ØªØ¬Ø²ÛŒÙ‡â€ŒÙ¾Ø°ÛŒØ± Ø¨Ø§Ø´Ø¯)
        function generateMission() {
            // Ù„ÛŒØ³ØªÛŒ Ø§Ø² Ø§Ø¹Ø¯Ø§Ø¯ Ø®ÙˆØ´â€ŒØ¯Ø³Øª Ø¨Ø±Ø§ÛŒ ØªØ¬Ø²ÛŒÙ‡ (ØªØ¹Ø¯Ø§Ø¯ Ø´Ú©Ù„Ø§Øªâ€ŒÙ‡Ø§)
            const targets = [8, 12, 16, 18, 20, 24, 27, 30, 32, 36, 40, 48, 50, 60, 64, 72, 80, 100];
            state.target = targets[Math.floor(Math.random() * targets.length)];
            
            // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ØªØºÛŒÛŒØ± Ø¹Ø¯Ø¯
            const targetEl = document.getElementById('targetCount');
            targetEl.style.transform = "scale(1.5)";
            setTimeout(() => targetEl.style.transform = "scale(1)", 200);
            targetEl.innerText = state.target;
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø§Ø³Ù„Ø§ÛŒØ¯Ø±Ù‡Ø§ Ø¨Ù‡ Ø­Ø§Ù„ØªÛŒ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¬Ø¨ÙˆØ± Ø¨Ù‡ ØªØºÛŒÛŒØ± Ø´ÙˆØ¯
            state.box = { L: 6, W: 6, H: 4 };
            updateUI();
        }

        function updateDims() {
            state.box.L = parseInt(document.getElementById('rangeL').value);
            state.box.W = parseInt(document.getElementById('rangeW').value);
            state.box.H = parseInt(document.getElementById('rangeH').value);
            
            document.getElementById('val-L').innerText = state.box.L;
            document.getElementById('val-W').innerText = state.box.W;
            document.getElementById('val-H').innerText = state.box.H;

            calculatePacking();
            draw();
            checkSuccess();
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI Ø¨Ø¯ÙˆÙ† Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² Ø§ÛŒÙ†Ù¾ÙˆØªâ€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§)
        function updateUI() {
            document.getElementById('rangeL').value = state.box.L;
            document.getElementById('rangeW').value = state.box.W;
            document.getElementById('rangeH').value = state.box.H;
            updateDims();
        }

        // Ù…Ù†Ø·Ù‚ Ø±ÛŒØ§Ø¶ÛŒ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ
        function calculatePacking() {
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø§ Ø´Ø¯Ù‡ Ø¯Ø± Ù‡Ø± Ø¨ÙØ¹Ø¯ (Integer Division)
            const countX = Math.floor(state.box.L / ITEM_SIZE);
            const countY = Math.floor(state.box.W / ITEM_SIZE);
            const countZ = Math.floor(state.box.H / ITEM_SIZE);

            state.fitted = countX * countY * countZ;

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…â€ŒÙ‡Ø§
            const volBox = state.box.L * state.box.W * state.box.H;
            const volItems = state.fitted * (ITEM_SIZE * ITEM_SIZE * ITEM_SIZE);
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ ÙØ¶Ø§ÛŒ Ù¾Ø± Ø´Ø¯Ù‡
            state.efficiency = (volItems / volBox) * 100;

            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
            document.getElementById('fitCount').innerText = state.fitted;
            
            const wastedPercent = 100 - state.efficiency;
            document.getElementById('wastedSpace').innerText = wastedPercent.toFixed(1) + "%";
            
            const bar = document.getElementById('effBar');
            bar.style.width = state.efficiency + "%";
            
            // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª
            if(state.efficiency === 100) bar.style.backgroundColor = "#43A047"; // Ø³Ø¨Ø²
            else if(state.efficiency > 80) bar.style.backgroundColor = "#FFB300"; // Ø²Ø±Ø¯
            else bar.style.backgroundColor = "#E53935"; // Ù‚Ø±Ù…Ø²
        }

        function checkSuccess() {
            const msg = document.getElementById('statusMsg');
            const diff = state.fitted - state.target;

            if (diff === 0 && state.efficiency === 100) {
                msg.innerHTML = "âœ… Ø¹Ø§Ù„ÛŒ! Ú©Ø§Ø±ØªÙ† Ú©Ø§Ù…Ù„Ø§Ù‹ Ù¾Ø± Ø´Ø¯ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ù‚ÛŒÙ‚ Ø§Ø³Øª.";
                msg.className = "status-msg win-anim";
            } else if (diff === 0 && state.efficiency < 100) {
                msg.innerHTML = "âš ï¸ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø³Øª Ø§Ø³ØªØŒ Ø§Ù…Ø§ ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø²ÛŒØ§Ø¯ Ø§Ø³Øª! (Ú©Ø§Ø±ØªÙ† Ø±Ø§ Ú©ÙˆÚ†Ú© Ú©Ù†)";
                msg.className = "status-msg";
            } else if (diff > 0) {
                msg.innerHTML = `âŒ ØªØ¹Ø¯Ø§Ø¯ ${diff} ØªØ§ Ø²ÛŒØ§Ø¯ Ø§Ø³Øª!`;
                msg.className = "status-msg";
            } else {
                msg.innerHTML = `ğŸ“‰ ØªØ¹Ø¯Ø§Ø¯ ${Math.abs(diff)} ØªØ§ Ú©Ù… Ø§Ø³Øª!`;
                msg.className = "status-msg";
            }
        }

        // --- Ø¨Ø®Ø´ Ø±Ø³Ù… (Canvas Logic) ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const cx = canvas.width / 2;
            const cy = canvas.height / 2 + 60;
            
            // Ù…Ù‚ÛŒØ§Ø³ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ø±Ø¶ ÙØ¹Ù„ÛŒ Ø¨ÙˆÙ… ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            // Ø¹Ø¯Ø¯ 25 ÛŒÚ© Ø¹Ø¯Ø¯ ØªØ¬Ø±Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø§Ø³Ø¨ Ø®ÙˆØ¨ Ø¯Ø± Ø§ÛŒÙ† Ø³Ø§ÛŒØ² Ø¨ÙˆÙ… Ø§Ø³Øª
            const scale = canvas.width / 25; 

            // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ù…Ø®ØªØµØ§Øª Ø³Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø¨Ù‡ Ø¯Ùˆ Ø¨Ø¹Ø¯ÛŒ (Ø§ÛŒØ²ÙˆÙ…ØªØ±ÛŒÚ©)
            function iso(x, y, z) {
                return {
                    x: cx + (x - y) * scale,
                    y: cy - (x + y) * scale * 0.5 - z * scale
                };
            }

            const L = state.box.L;
            const W = state.box.W;
            const H = state.box.H;

            // 1. Ø±Ø³Ù… Ú©Ù Ú©Ø§Ø±ØªÙ† (Ù¾Ø´Øª)
            ctx.lineWidth = 1;
            ctx.strokeStyle = "#ccc";
            const p0 = iso(0, 0, 0);
            const p1 = iso(L, 0, 0);
            const p2 = iso(L, W, 0);
            const p3 = iso(0, W, 0);
            
            ctx.beginPath();
            ctx.moveTo(p0.x, p0.y); ctx.lineTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.lineTo(p3.x, p3.y); ctx.closePath();
            ctx.fillStyle = "rgba(255, 255, 255, 0.5)"; ctx.fill(); ctx.stroke();

            // 2. Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø¹Ø¨Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø³Ù…
            const nx = Math.floor(L / ITEM_SIZE);
            const ny = Math.floor(W / ITEM_SIZE);
            const nz = Math.floor(H / ITEM_SIZE);

            // Ø±Ø³Ù… Ø´Ú©Ù„Ø§Øªâ€ŒÙ‡Ø§ (Ø¬Ø¹Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©)
            for (let z = 0; z < nz; z++) {
                for (let y = 0; y < ny; y++) {
                    for (let x = 0; x < nx; x++) {
                        drawCube(
                            x * ITEM_SIZE, 
                            y * ITEM_SIZE, 
                            z * ITEM_SIZE, 
                            ITEM_SIZE, 
                            scale, 
                            iso
                        );
                    }
                }
            }

            // 3. Ø±Ø³Ù… Ø®Ø·ÙˆØ· Ù…Ø­ÛŒØ·ÛŒ Ú©Ø§Ø±ØªÙ† Ø¨Ø²Ø±Ú¯ (Wireframe) Ø±ÙˆÛŒ Ù‡Ù…Ù‡ Ú†ÛŒØ²
            ctx.lineWidth = 3 * (scale/20); // Ø¶Ø®Ø§Ù…Øª Ø®Ø· Ù‡Ù… Ø¨Ø§ Ù…Ù‚ÛŒØ§Ø³ ØªØºÛŒÛŒØ± Ú©Ù†Ø¯
            ctx.strokeStyle = "#8D6E63"; // Ø±Ù†Ú¯ Ú©Ø§Ø±ØªÙ†
            ctx.lineJoin = 'round';

            // Ú©Ù
            ctx.beginPath();
            ctx.moveTo(p0.x, p0.y); ctx.lineTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.lineTo(p3.x, p3.y); ctx.closePath();
            ctx.stroke();

            // Ø³ØªÙˆÙ†â€ŒÙ‡Ø§
            const top0 = iso(0, 0, H);
            const top1 = iso(L, 0, H);
            const top2 = iso(L, W, H);
            const top3 = iso(0, W, H);

            ctx.beginPath(); ctx.moveTo(p0.x, p0.y); ctx.lineTo(top0.x, top0.y); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(top1.x, top1.y); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(p2.x, p2.y); ctx.lineTo(top2.x, top2.y); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(p3.x, p3.y); ctx.lineTo(top3.x, top3.y); ctx.stroke();

            // Ø³Ù‚Ù
            ctx.beginPath();
            ctx.moveTo(top0.x, top0.y); ctx.lineTo(top1.x, top1.y); ctx.lineTo(top2.x, top2.y); ctx.lineTo(top3.x, top3.y); ctx.closePath();
            ctx.stroke();
            
            // Ù†Ù…Ø§ÛŒØ´ ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø¨Ø§ Ù‡Ø§Ø´ÙˆØ± Ù‚Ø±Ù…Ø² Ú©Ù…Ø±Ù†Ú¯ Ø§Ú¯Ø± Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Û±Û°Û° Ù†ÛŒØ³Øª
            if (state.efficiency < 100) {
                ctx.fillStyle = "rgba(255, 0, 0, 0.05)";
                ctx.beginPath();
                ctx.moveTo(top0.x, top0.y); ctx.lineTo(top1.x, top1.y); ctx.lineTo(top2.x, top2.y); ctx.lineTo(top3.x, top3.y);
                ctx.lineTo(p2.x, p2.y); ctx.lineTo(p1.x, p1.y); ctx.lineTo(p0.x, p0.y); ctx.lineTo(p3.x, p3.y); 
                ctx.fill();
            }
        }

        function drawCube(x, y, z, size, scale, isoFunc) {
            const gap = 0.1; 
            const s = size - gap;
            
            const p = isoFunc(x, y, z);
            
            const p_top_L = isoFunc(x, y, z + s);
            const p_top_R = isoFunc(x + s, y, z + s);
            const p_top_B = isoFunc(x + s, y + s, z + s);
            const p_top_F = isoFunc(x, y + s, z + s);
            
            const p_bott_R = isoFunc(x + s, y, z);
            const p_bott_B = isoFunc(x + s, y + s, z);
            const p_bott_F = isoFunc(x, y + s, z);

            ctx.lineWidth = 1;
            ctx.strokeStyle = "#3E2723";

            // ÙˆØ¬Ù‡ Ø¨Ø§Ù„Ø§
            ctx.fillStyle = "#795548";
            ctx.beginPath();
            ctx.moveTo(p_top_L.x, p_top_L.y); ctx.lineTo(p_top_R.x, p_top_R.y);
            ctx.lineTo(p_top_B.x, p_top_B.y); ctx.lineTo(p_top_F.x, p_top_F.y);
            ctx.closePath(); ctx.fill(); ctx.stroke();

            // ÙˆØ¬Ù‡ Ø±Ø§Ø³Øª
            ctx.fillStyle = "#5D4037";
            ctx.beginPath();
            ctx.moveTo(p_top_R.x, p_top_R.y); ctx.lineTo(p_top_B.x, p_top_B.y);
            ctx.lineTo(p_bott_B.x, p_bott_B.y); ctx.lineTo(p_bott_R.x, p_bott_R.y);
            ctx.closePath(); ctx.fill(); ctx.stroke();

            // ÙˆØ¬Ù‡ Ø¬Ù„Ùˆ
            ctx.fillStyle = "#4E342E";
            ctx.beginPath();
            ctx.moveTo(p_top_F.x, p_top_F.y); ctx.lineTo(p_top_B.x, p_top_B.y);
            ctx.lineTo(p_bott_B.x, p_bott_B.y); ctx.lineTo(p_bott_F.x, p_bott_F.y);
            ctx.closePath(); ctx.fill(); ctx.stroke();
        }

        // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø³Ø§ÛŒØ² (Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ)
        resizeCanvas(); 
        
    </script>
</body>
</html>